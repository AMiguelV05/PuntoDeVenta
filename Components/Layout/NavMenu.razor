@using PuntoDeVenta.Services
@rendermode InteractiveServer
@inject EstadoAutenticacionService AuthService
@inject NavigationManager NavManager
@implements IDisposable

<div class="top-row ps-3 navbar navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="">PuntoDeVenta</a>
    </div>
</div>

<input type="checkbox" title="Navigation menu" class="navbar-toggler" />


<div class="nav-scrollable" onclick="document.querySelector('.navbar-toggler').click()">
    <nav class="flex-column">
        
        @if (!AuthService.EstaLogueado)
        {
            <!-- --- USUARIO NO LOGUEADO --- -->
            <div class="nav-item px-3">
                <NavLink class="nav-link" href="login" Match="NavLinkMatch.All">
                    <span class="bi bi-box-arrow-in-right" aria-hidden="true"></span> Iniciar Sesión
                </NavLink>
            </div>
            <div class="nav-item px-3">
                <NavLink class="nav-link" href="registro">
                    <span class="bi bi-person-plus" aria-hidden="true"></span> Registrarse
                </NavLink>
            </div>
        }
        else
        {
            <!-- --- USUARIO LOGUEADO --- -->
            <div class="nav-item px-3">
                <div style="color: #d7d7d7; padding: 0.75rem 0.8rem; line-height: 1.4;"> 
                    <div>
                        <span class="bi bi-person-circle" aria-hidden="true" 
                              style="width: 1.25rem; height: auto; margin-right: 0.75rem; position: relative; top: 2px;">
                        </span> 
                        Hola, 
                    </div>
                    <div style="padding-left: 2.1rem; margin-top: 0.1rem;">
                        <strong>@AuthService.EmpleadoActual?.Nombre</strong>
                    </div>
                    <div style="padding-left: 2.1rem; margin-top: 0.35rem;">
                        <span class="badge @GetBadgeClass(AuthService.EmpleadoActual?.Puesto)">
                            @AuthService.EmpleadoActual?.Puesto
                        </span>
                    </div>
                </div>
            </div>
            
            <div class="nav-item px-3">
                <NavLink class="nav-link" href="" Match="NavLinkMatch.All">
                    <i class="bi bi-house-door-fill" aria-hidden="true"></i> Home
                </NavLink>
             </div>

            @if(AuthService.EstaAprobado)
            {
                 <!-- Solo mostrar si la cuenta está aprobada -->
                <div class="nav-item px-3">
                    <NavLink class="nav-link" href="venta">
                        <span class="bi bi-cart-fill" aria-hidden="true"></span> Terminal Venta
                    </NavLink>
                </div>
                <div class="nav-item px-3">
                    <NavLink class="nav-link" href="reportes/ventas">
                        <span class="bi bi-bar-chart-fill" aria-hidden="true"></span> Reporte Ventas
                    </NavLink>
                </div>
            }

            @if(AuthService.EsAdmin)
            {
                <!-- Solo mostrar a Administradores -->
                <div class="nav-item px-3">
                    <NavLink class="nav-link" href="admin/gestion">
                        <span class="bi bi-shield-lock-fill" aria-hidden="true"></span> Gestión Empleados
                    </NavLink>
                </div>
            }
            
            <div class="nav-item px-3">
                <button class="btn btn-link nav-link" @onclick="HandleLogout">
                    <span class="bi bi-box-arrow-left" aria-hidden="true"></span> Cerrar Sesión
                </button>
            </div>
        }
        
    </nav>
</div>

@code {
    protected override void OnInitialized()
    {
        AuthService.OnChange += StateHasChanged;
    }

    public void Dispose()
    {
        AuthService.OnChange -= StateHasChanged;
    }

    private void HandleLogout()
    {
        AuthService.CerrarSesion();
        NavManager.NavigateTo("/login");
    }

    private string GetBadgeClass(string? puesto)
    {
        return puesto switch
        {
            "Administrador" => "bg-primary",
            "Vendedor" => "bg-success",
            "en espera" => "bg-warning text-dark",
            _ => "bg-secondary"
        };
    }
}