@using PuntoDeVenta.Services
@inject EstadoAutenticacionService AuthService
@inject NavigationManager NavManager

<div class="nav-scrollable" onclick="document.querySelector('.navbar-toggler').click()">
    <nav class="flex-column">
        
        @if (!AuthService.EstaLogueado)
        {
            <!-- --- USUARIO NO LOGUEADO --- -->
            <div class="nav-item px-3">
                <NavLink class="nav-link" href="login" Match="NavLinkMatch.All">
                    <span class="bi bi-box-arrow-in-right" aria-hidden="true"></span> Iniciar Sesión
                </NavLink>
            </div>
            <div class="nav-item px-3">
                <NavLink class="nav-link" href="registro">
                    <span class="bi bi-person-plus" aria-hidden="true"></span> Registrarse
                </NavLink>
            </div>
        }
        else
        {
            <!-- --- USUARIO LOGUEADO --- -->
            <div class="nav-item px-3">
                <div class="nav-link">
                    <span class="bi bi-person-circle" aria-hidden="true"></span> Hola, @AuthService.EmpleadoActual?.Nombre
                    <br />
                    <span class="badge @GetBadgeClass(AuthService.EmpleadoActual?.Puesto)">
                        @AuthService.EmpleadoActual?.Puesto
                    </span>
                </div>
            </div>
            
            @if(AuthService.EstaAprobado)
            {
                 <!-- Solo mostrar si la cuenta está aprobada -->
                <div class="nav-item px-3">
                    <NavLink class="nav-link" href="venta">
                        <span class="bi bi-cart-fill" aria-hidden="true"></span> Terminal Venta
                    </NavLink>
                </div>
                <div class="nav-item px-3">
                    <NavLink class="nav-link" href="reportes/ventas">
                        <span class="bi bi-bar-chart-fill" aria-hidden="true"></span> Reporte Ventas
                    </NavLink>
                </div>
            }

            @if(AuthService.EsAdmin)
            {
                <!-- Solo mostrar a Administradores -->
                <div class="nav-item px-3">
                    <NavLink class="nav-link" href="admin/gestion">
                        <span class="bi bi-shield-lock-fill" aria-hidden="true"></span> Gestión Empleados
                    </NavLink>
                </div>
            }
            
            <div class="nav-item px-3">
                <button class="btn btn-link nav-link" @onclick="HandleLogout">
                    <span class="bi bi-box-arrow-left" aria-hidden="true"></span> Cerrar Sesión
                </button>
            </div>
        }
        
    </nav>
</div>

@code {
    protected override void OnInitialized()
    {
        AuthService.OnChange += StateHasChanged;
    }

    public void Dispose()
    {
        AuthService.OnChange -= StateHasChanged;
    }

    private void HandleLogout()
    {
        AuthService.CerrarSesion();
        NavManager.NavigateTo("/login");
    }

    private string GetBadgeClass(string? puesto)
    {
        return puesto switch
        {
            "Administrador" => "bg-primary",
            "Vendedor" => "bg-success",
            "en espera" => "bg-warning text-dark",
            _ => "bg-secondary"
        };
    }
}