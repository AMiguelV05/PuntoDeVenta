@page "/tutorial"
@rendermode InteractiveServer
@using PuntoDeVenta.Services
@inject EstadoAutenticacionService AuthService
@inject NotificationService Notifier
@inject NavigationManager NavManager

<PageTitle>Tutorial del POS</PageTitle>

<div class="container pt-3">
    <div class="row justify-content-center">
        <div class="col-md-10 col-lg-9">
            <h3 class="mb-4 text-center"><i class="bi bi-book-half me-2"></i>Centro de Ayuda y Tutoriales</h3>

            <ul class="nav nav-tabs mb-3" id="tutorialTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="ventas-tab" data-bs-toggle="tab" data-bs-target="#ventas-content" type="button" role="tab">
                        <i class="bi bi-cart-check me-2"></i>Cómo Vender
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="inventario-tab" data-bs-toggle="tab" data-bs-target="#inventario-content" type="button" role="tab">
                        <i class="bi bi-box-seam me-2"></i>Inventario y Compras
                    </button>
                </li>
            </ul>

            <div class="tab-content shadow-sm p-4 bg-white rounded border" id="tutorialTabContent">
                
                <div class="tab-pane fade show active" id="ventas-content" role="tabpanel">
                    <h4 class="text-success mb-3">Flujo de Venta en Caja</h4>
                    <div class="accordion" id="accordionVentas">
                        
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#v-paso1">
                                    <i class="bi bi-search me-2"></i> <strong>Paso 1: Buscar Producto</strong>
                                </button>
                            </h2>
                            <div id="v-paso1" class="accordion-collapse collapse show" data-bs-parent="#accordionVentas">
                                <div class="accordion-body">
                                    Ve a <strong>"Caja / Terminal"</strong>. Usa la barra superior para escanear un código de barras o escribir el nombre del producto (ej: "Coca Cola").
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#v-paso2">
                                    <i class="bi bi-cart-plus me-2"></i> <strong>Paso 2: Agregar al Carrito</strong>
                                </button>
                            </h2>
                            <div id="v-paso2" class="accordion-collapse collapse" data-bs-parent="#accordionVentas">
                                <div class="accordion-body">
                                    Haz clic en el botón verde <strong>"Agregar"</strong>. Si necesitas más de una unidad, modifica la casilla de "Cantidad" directamente en la tabla del carrito.
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#v-paso3">
                                    <i class="bi bi-cash-coin me-2"></i> <strong>Paso 3: Finalizar y Cobrar</strong>
                                </button>
                            </h2>
                            <div id="v-paso3" class="accordion-collapse collapse" data-bs-parent="#accordionVentas">
                                <div class="accordion-body">
                                    <ol>
                                        <li>(Opcional) Selecciona un <strong>Cliente</strong> del menú desplegable si deseas registrar la venta a su nombre.</li>
                                        <li>Presiona <strong>"Cobrar y Finalizar"</strong> (o la tecla F12).</li>
                                        <li>Ingresa el monto con el que paga el cliente para calcular el cambio.</li>
                                        <li>Confirma para guardar la venta y descontar el stock.</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="inventario-content" role="tabpanel">
                    <h4 class="text-warning mb-3">Recepción de Mercancía (Resurtido)</h4>
                    <p class="text-muted">Usa este módulo cuando lleguen camiones de proveedores o compres nuevo stock.</p>
                    
                    <div class="accordion" id="accordionInventario">
                        
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#i-paso1">
                                    <i class="bi bi-truck me-2"></i> <strong>Paso 1: Proveedores</strong>
                                </button>
                            </h2>
                            <div id="i-paso1" class="accordion-collapse collapse show" data-bs-parent="#accordionInventario">
                                <div class="accordion-body">
                                    Antes de registrar una entrada, asegúrate de que el proveedor exista en el sistema.
                                    Ve a la sección <strong>Proveedores</strong> y crea uno nuevo si es necesario. <br/>
                                    <em>Nota: Es obligatorio asignar un proveedor a cada entrada de mercancía.</em>
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#i-paso2">
                                    <i class="bi bi-box-arrow-in-down me-2"></i> <strong>Paso 2: Registrar Entrada</strong>
                                </button>
                            </h2>
                            <div id="i-paso2" class="accordion-collapse collapse" data-bs-parent="#accordionInventario">
                                <div class="accordion-body">
                                    <ol>
                                        <li>Ve a <strong>"Entrada de Mercancía"</strong>.</li>
                                        <li>Busca los productos que están llegando y agrégalos a la lista.</li>
                                        <li>Edita el <strong>Costo Unitario</strong> si el precio de compra ha cambiado (esto actualizará el costo en el sistema).</li>
                                        <li>Selecciona el Proveedor en el menú derecho.</li>
                                        <li>Haz clic en <strong>"Registrar Entrada"</strong>. El stock se sumará automáticamente al actual.</li>
                                    </ol>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

            </div>
            
            <div class="mt-4 alert alert-info text-center">
                <i class="bi bi-info-circle-fill me-2"></i>
                Recuerda que para acceder a estas funciones tu cuenta debe tener permisos de <strong>Vendedor</strong> o <strong>Administrador</strong>.
            </div>
        </div>
    </div>
</div>

@code {
    protected override void OnInitialized()
    {
        if (AuthService.EmpleadoActual == null)
        {
            NavManager.NavigateTo("/login");
            return;
        }
    }
}